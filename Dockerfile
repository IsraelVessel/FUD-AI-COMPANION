# Use Node.js 18 LTS as base image\nFROM node:18-alpine\n\n# Set working directory\nWORKDIR /app\n\n# Create non-root user for security\nRUN addgroup -g 1001 -S nodejs\nRUN adduser -S nextjs -u 1001\n\n# Copy package files\nCOPY backend/package*.json ./backend/\nCOPY frontend/package*.json ./frontend/\n\n# Install dependencies\nRUN cd backend && npm ci --only=production && npm cache clean --force\nRUN cd frontend && npm ci --only=production && npm cache clean --force\n\n# Copy application code\nCOPY backend/ ./backend/\nCOPY frontend/ ./frontend/\nCOPY database/ ./database/\n\n# Build frontend\nRUN cd frontend && npm run build\n\n# Create uploads directory\nRUN mkdir -p backend/uploads/profiles && chown -R nextjs:nodejs backend/uploads\n\n# Create logs directory\nRUN mkdir -p backend/logs && chown -R nextjs:nodejs backend/logs\n\n# Switch to non-root user\nUSER nextjs\n\n# Expose port\nEXPOSE 3000\n\n# Set environment to production\nENV NODE_ENV=production\n\n# Start the application\nCMD [\"node\", \"backend/src/server.js\"]"
